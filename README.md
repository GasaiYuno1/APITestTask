Dev notes

Swagger был использован больше для моего удобства, как в и возможность 
совершать запросы не только в виде файла но и в виде текста.

# Сервис рекламных площадок

Веб сервис для управления рекламными площадками и поиска подходящих площадок по локации.

## Описание

Сервис позволяет:
- Загружать информацию о рекламных площадках из файла или текста
- Искать рекламные площадки для заданной локации
- Работает с иерархией локаций (вложенные локации)

## Архитектура

- **ASP.NET Core Web API** - основной фреймворк
- **In-memory storage** - данные хранятся в оперативной памяти
- **Оптимизированный поиск** - предварительная индексация для быстрого поиска
- **Thread-safe** - безопасная работа в многопоточной среде

## Требования

- .NET 9.0 SDK
- Windows/Linux/macOS

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd APITestTask
```

### 2. Восстановление зависимостей
```bash
dotnet restore
```

### 3. Запуск приложения
```bash
cd APITestTask
dotnet run
```

Приложение будет доступно по адресу:
- HTTP: `http://localhost:5000`
- HTTPS: `https://localhost:5001`
- Swagger UI: `https://localhost:5001/swagger`

## API Endpoints

### 1. Загрузка рекламных площадок из файла

**POST** `/api/adplatforms/upload`

Загружает данные из файла. Полностью перезаписывает существующие данные.

**Content-Type:** `multipart/form-data`

**Параметры:**
- `file` - текстовый файл с данными рекламных площадок

**Пример запроса:**
```bash
curl -X POST "https://localhost:5001/api/adplatforms/upload" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@ad_platforms.txt"
```

### 2. Загрузка рекламных площадок из текста

**POST** `/api/adplatforms/upload-content`

Загружает данные из текстового содержимого в теле запроса.

**Content-Type:** `application/json`

**Тело запроса:** строка с данными

**Пример запроса:**
```bash
curl -X POST "https://localhost:5001/api/adplatforms/upload-content" \
  -H "Content-Type: application/json" \
  -d "\"Яндекс.Директ:/ru\nРевдинский рабочий:/ru/svrd/revda,/ru/svrd/pervik\""
```

### 3. Поиск рекламных площадок

**GET** `/api/adplatforms/search?location={location}`

Возвращает список рекламных площадок для заданной локации.

**Параметры:**
- `location` - строка с локацией (например, `/ru/svrd/revda`)

**Пример запроса:**
```bash
curl "https://localhost:5001/api/adplatforms/search?location=/ru/svrd/revda"
```

**Пример ответа:**
```json
{
  "location": "/ru/svrd/revda",
  "platforms": [
    "Яндекс.Директ",
    "Ревдинский рабочий",
    "Крутая реклама"
  ]
}
```

## Формат данных

Файл с рекламными площадками должен содержать строки в формате:
```
Название площадки:локация1,локация2,локацияN
```

**Пример файла:**
```
Яндекс.Директ:/ru
Ревдинский рабочий:/ru/svrd/revda,/ru/svrd/pervik
Газета уральских москвичей:/ru/msk,/ru/permobl,/ru/chelobl
Крутая реклама:/ru/svrd
```

## Логика работы с локациями

Локации имеют иерархическую структуру:
- `/ru/svrd/ekb` вложена в `/ru/svrd`
- `/ru/svrd` вложена в `/ru`
- Рекламная площадка действует во всех указанных локациях и их подлокациях

**Примеры поиска:**
- Для `/ru` найдется только "Яндекс.Директ"
- Для `/ru/svrd` найдутся "Яндекс.Директ" и "Крутая реклама"
- Для `/ru/svrd/revda` найдутся "Яндекс.Директ", "Ревдинский рабочий" и "Крутая реклама"

## Запуск тестов

```bash
cd Tests
dotnet test
```

## Производительность

- **Загрузка данных**: O(n*m), где n - количество площадок, m - среднее количество локаций на площадку
- **Поиск**: O(k), где k - глубина иерархии локаций (обычно очень мала, близко к O(1))
- **Память**: данные хранятся в Dictionary с индексом локаций для быстрого доступа

## Обработка ошибок

- Некорректные строки в файле игнорируются
- Пустые локации и названия площадок игнорируются
- API возвращает понятные сообщения об ошибках
- Приложение не падает при некорректных входных данных